"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var function_1 = require("fp-ts/lib/function");
var Option_1 = require("fp-ts/lib/Option");
var pipeable_1 = require("fp-ts/lib/pipeable");
function collectUntil(M, F) {
    return function (f) {
        var go = function (mfa) {
            return M.chain(mfa, function (_a) {
                var fx = _a[0], oi = _a[1];
                return pipeable_1.pipe(oi, Option_1.fold(function () { return M.of(fx); }, function (i) { return go(M.map(f(i), function (_a) {
                    var fy = _a[0], oi = _a[1];
                    return [F.alt(fx, function () { return fy; }), oi];
                })); }));
            });
        };
        return function_1.flow(f, go);
    };
}
exports.collectUntil = collectUntil;
