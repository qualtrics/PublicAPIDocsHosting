"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("react"),n=require("@stoplight/lifecycle"),r=require("mobx"),i=require("@stoplight/ui-kit"),o=(e=require("classnames"))&&"object"==typeof e&&"default"in e?e.default:e,s=require("mobx-react-lite"),a=require("@stoplight/react-error-boundary"),l=require("@stoplight/ui-kit/ScrollList");
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function d(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}function c(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}const h=()=>Math.random().toString(36).slice(2);class u{constructor(){this[Symbol.toStringTag]="SwappableWeakMap",this._collection=new WeakMap}delete(e){return this._collection.delete(e)}get(e){return this._collection.get(e)}set(e,t){return this._collection.set(e,t),this}has(e){return this._collection.has(e)}swap(){this._collection=new WeakMap}}class p{constructor(){this[Symbol.toStringTag]="SwappableWeakSet",this._collection=new WeakSet}delete(e){return this._collection.delete(e)}add(e){return this._collection.add(e),this}has(e){return this._collection.has(e)}swap(){this._collection=new WeakSet}}function g(e){return e===WeakMap?new u:new p}class f{constructor(e){this.size=e,this.head=-1,this.tail=-1,this.cache=new Map}set(e,t){(-1===this.head||e<this.head)&&(this.head=e),(-1===this.tail||e>this.tail)&&(this.tail=e),this.cache.size===this.size&&(e<=this.head?(this.cache.delete(this.tail),this.tail--):(this.cache.delete(this.head),this.head++)),this.cache.set(e,t)}get(e){return e<0?void 0:this.cache.get(e)}clear(e){if(e<=this.head)this.cache.clear();else{for(;e++<=this.tail;)this.cache.delete(e);this.tail=e}}}function m(e){if(!v(e))throw new TypeError("Parent node expected")}const v=e=>"object"==typeof e&&null!==e&&"children"in e,x=Symbol("COUNT"),C=Symbol("LEVEL"),N=Symbol("DROP_ZONE_ID"),y=[];class b{constructor(e=null,t=b.createArtificialRoot(),n=200){this.iterationOptions=e,this.unwrapped=g(WeakSet),this.sorted=g(WeakSet),this.filtered=g(WeakMap),this._versionCounter=0,this._count=0,this.indexLookup=new f(n),this.setRoot(t)}get root(){return this._root}get versionCounter(){return this._versionCounter}set versionCounter(e){this._versionCounter=e}get count(){return this._count}set count(e){this._count=e,this.versionCounter++}setRoot(e){this._root=e,this.invalidate()}static getLevel(e){return e[C]}static getDropZoneId(e){return e[N]}clearCache(){this.indexLookup.clear(-1)}getFilteredChildren(e){var t;if(!this.unwrapped.has(e))return y;const n=null===(t=this.iterationOptions)||void 0===t?void 0:t.filter;if(0===e.children.length)return e.children;const r=this.filtered.get(e);if(void 0!==r)return r;if(!n)return e.children;const i=e.children.filter(n);return this.filtered.set(e,i),i}getChildren(e){const t=this.getFilteredChildren(e);return null===this.iterationOptions||0===t.length?t:(null===this.iterationOptions.order||this.sorted.has(e)||(t.sort(this.iterationOptions.order),this.sorted.add(e)),t)}static _toTree(e,t){const n=[e];for(const e of t){const t=n[e.level],r=b.transformDeprecatedNode(e,null);v(r)&&(e.level>=n.length?n.push(r):n[e.level+1]=r),t&&(r.parent=t,t.children.push(r))}}static createArtificialRoot(){return{id:h(),name:"",parent:null,children:[]}}static toTree(e){const t={id:h(),name:"",parent:null,children:[]};return b._toTree(t,e.slice()),t}*[Symbol.iterator](){yield*this.getIteratorForNode(this.root)}*getIteratorForNode(e){for(const t of this.getChildren(e))yield t,v(t)&&(yield*this.getIteratorForNode(t))}static getOffsetForNode(e){return-1}binaryItemAt(e,t,n){if(t<0)return;const r=this.indexLookup.get(t);if(void 0!==r)return r;const{length:i}=n;for(const r of this.getChildren(e)){if(n.offset++,t===n.offset-1)return this.indexLookup.set(t,r),r;if(v(r)&&n.offset-1<=t&&t<=n.offset-1+i){n.length=r[x];const e=this.binaryItemAt(r,t,n);if(void 0!==e)return e}else x in r&&(n.offset+=r[x])}}linerItemAt(e){let t=0;for(const n of this){if(t===e)return this.indexLookup.set(e,n),n;t++}}getLastItem(e){if(!v(e))return e;const t=this.getChildren(e);return 0===t.length?e:this.getLastItem(t[t.length-1])}_nextItem(e){if(null===e.parent)return;const t=this.getChildren(e.parent),n=0===t.length?-1:t.indexOf(e);return n<t.length-1?t[n+1]:this._nextItem(e.parent)}nextItem(e){if(v(e)){const t=this.getChildren(e);if(t.length>0)return t[0]}return this._nextItem(e)}prevItem(e){if(!v(e)||null===e.parent)return;const t=this.getChildren(e),n=0===t.length?-1:t.indexOf(e);return n>0&&t.length>0?this.getLastItem(t[n-1]):void 0}itemAt(e){if(!(e<0)){if(e<this.count&&this.indexLookup.tail+1===e){const t=this.indexLookup.get(this.indexLookup.tail);if(t){const n=this.nextItem(t);if(n)return this.indexLookup.set(e,n),n}}else if(e>1&&this.indexLookup.head-1===e){const t=this.indexLookup.get(this.indexLookup.head);if(t){const n=this.prevItem(t);if(n)return this.indexLookup.set(e,n),n}}return b.boundaries.offset=0,b.boundaries.length=this.count,this.binaryItemAt(this.root,e,b.boundaries)}}indexOf(e){let t=0;for(const n of this){if(e===n)return t;t++}return-1}every(e,t){let n=0;for(const r of this)if(!e.call(t,r,n++,[]))return!1;return!0}findById(e){for(const t of this)if(t.id===e)return t}invalidate(){this.unwrapped.swap(),this.clearCache(),this.invalidateOrder(),this.invalidateNode(this.root),this.count=this.processTreeFragment(this.root)}forceUpdate(){this.versionCounter++}invalidateCounter(e,t){let n=e;do{this.resetCounter(n),n=n.parent}while(t&&null!==n)}invalidateLevel(e){if(b.resetLevel(e),v(e))for(const t of e.children)this.invalidateLevel(t)}invalidateNode(e){this.invalidateLevel(e),v(e)&&(this.filtered.delete(e),this.sorted.delete(e),this.invalidateCounter(e,!0))}invalidateOrder(){this.sorted.swap(),this.filtered.swap()}wrap(e){this.unwrapped.has(e)&&(this.clearCache(),this.getFilteredChildren(e).length>0&&(this.count-=e[x]),this.unwrapped.delete(e),this.invalidateCounter(e,null!==e.parent&&this.unwrapped.has(e.parent)))}unwrap(e){var t;if(!this.unwrapped.has(e)){if(this.unwrapped.add(e),null!==e.parent&&!this.unwrapped.has(e.parent))return void this.invalidateCounter(e,!1);this.clearCache();const n=this.count,r=this.getFilteredChildren(e);if(r.length>0){const e=null===(t=this.iterationOptions)||void 0===t?void 0:t.expanded;for(const t of r)!v(t)||this.unwrapped.has(t)||e&&!e(t)||this.unwrap(t)}this.invalidateCounter(e,!0),this.count=n+e[x]}}moveNode(e,t){this.removeNode(e),this.insertNode(e,t)}prepareNode(e,t){e.parent=t,t.children.push(e),this.decorateNode(e),this.invalidateLevel(e),v(e)&&this.processTreeFragment(e)}insertNode(e,t){const n=t[x];this.prepareNode(e,t),void 0!==n&&(this.clearCache(),this.invalidateNode(t),this.count+=t[x]-n)}insertTreeFragment(e,t){const n=t[x];for(const n of e)this.prepareNode(n,t);void 0!==n&&(this.clearCache(),this.invalidateNode(t),this.count+=t[x]-n)}removeNode(e){if(null===e.parent)throw new Error("Cannot remove root node");const{parent:t}=e,n=t[x];t.children.splice(t.children.indexOf(e),1),void 0!==n&&(this.clearCache(),this.invalidateNode(t),this.count+=t[x]-n)}replaceNode(e,t){if(null===e.parent)return m(t),void this.setRoot(t);const{parent:n}=e,r=n[x];n.children[n.children.indexOf(e)]=t,void 0!==r&&(this.clearCache(),this.invalidateNode(n),this.count+=n[x]-r)}getCount(e){return e[x]}setCount(e,t){e[x]=Math.max(0,t)}resetCounter(e){let t=0;for(const n of this.getFilteredChildren(e))x in n&&(t+=n[x]),t+=1;e[x]=t}processTreeFragment(e){var t;let n=0;if(this.decorateNode(e),v(e)){const r=null===(t=this.iterationOptions)||void 0===t?void 0:t.expanded;if(!r||r(e)){this.unwrapped.add(e);for(const t of this.getFilteredChildren(e))v(t)?n+=this.processTreeFragment(t):this.decorateNode(t),n+=1}e[x]=n}return n}static resetLevel(e){Object.defineProperty(e,C,b.level)}static resetDropZoneId(e){Object.defineProperty(e,N,b.dropZoneId)}decorateNode(e){C in e||b.resetLevel(e),N in e||b.resetDropZoneId(e)}static isDecoratedNode(e){return"object"==typeof e&&null!==e&&C in e&&N in e}static transformDeprecatedNode(e,t){const n={...e,...e.canHaveChildren&&{children:[]},parent:t};return delete n.level,delete n.canHaveChildren,n}}b.level={configurable:!0,get(){const{parent:e}=this,t=null===e?-1:(C in e?e[C]:0)+1;return v(this)&&Object.defineProperty(this,C,{configurable:!0,value:t}),t}},b.dropZoneId={configurable:!0,get(){const{parent:e}=this,t=`${null!==e&&N in e?`${e[N]}${this.id}`:this.id}-`;return v(this)&&Object.defineProperty(this,N,{configurable:!0,value:t}),t}},b.boundaries={offset:0,length:0},d([r.observable,c("design:type",Object)],b.prototype,"_versionCounter",void 0),d([r.computed,c("design:type",Object),c("design:paramtypes",[Object])],b.prototype,"versionCounter",null),d([r.action,c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",void 0)],b.prototype,"forceUpdate",null);class E{constructor(e){var t,n,r;this.expanded=null!==(t=null==e?void 0:e.expanded)&&void 0!==t?t:{},this.activeNodeId=null!==(n=null==e?void 0:e.activeNodeId)&&void 0!==n?n:null,this.editedNodeId=null!==(r=null==e?void 0:e.editedNodeId)&&void 0!==r?r:null}setExpanded(e){this.expanded=e}}d([r.observable.shallow,c("design:type",Object)],E.prototype,"expanded",void 0),d([r.observable,c("design:type",Object)],E.prototype,"activeNodeId",void 0),d([r.observable,c("design:type",Object)],E.prototype,"editedNodeId",void 0),d([r.action,c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",void 0)],E.prototype,"setExpanded",null);class w extends b{constructor(e,t,n=null){const r=t(e);super(n,r),this.transformNode=t,this.transformedNodes=new WeakMap([[e,r]]),this.transformChildren(r),this.processTreeFragment(this.root),this.count=this.getCount(this.root)}transform(e,t){const n=this.transformNode(e);return n.parent=t,n}transformChildren(e){e.children=e.children.map(t=>{const n=this.transformNode(t);return n.parent=e,super.decorateNode(n),n})}decorateNode(e){if(w.isDecoratedNode(e))return;const t=this.transform(e,e.parent&&this.transformedNodes.get(e.parent)||null);"children"in e&&(this.transformedNodes.set(e,t),this.transformChildren(t)),super.decorateNode(t)}}class T extends b{constructor(e,t=null,n=b.createArtificialRoot(),r=200){super(t,n,r),this.visited=g(WeakSet),this.computeRows=e}static mapById(e){return e.id}compute(e,t){if(!this.visited.has(e)){e.children=this.computeRows(e),void 0!==t&&(e.children=e.children.filter(e=>!t.includes(e.id)));for(const t of e.children)this.decorateNode(t);this.visited.add(e)}}processTreeFragment(e){return this.compute(e),super.processTreeFragment(e)}unwrap(e){return this.compute(e),super.unwrap(e)}insertTreeFragment(e,t){return this.compute(t,e.map(T.mapById)),super.insertTreeFragment(e,t)}insertNode(e,t){return this.compute(t,[e.id]),super.insertNode(e,t)}invalidate(){if(this.computeRows)return this.visited.swap(),super.invalidate()}}var L,I;(L=exports.TreeListEvents||(exports.TreeListEvents={})).NodeClick="node.click",L.NodeMouseEnter="node.mouseenter",L.NodeMouseLeave="node.mouseexit",L.NodeDoubleClick="node.doubleClick",L.NodeCaretClick="node.caretClick",L.NodeExpand="node.expand",L.Drop="drop",L.EditCancel="edit.cancel",L.ValidationError="edit.validationError",L.BeforeEditComplete="edit.beforecomplete",L.AfterEditComplete="edit.aftercomplete",(I=exports.TreeListCaretIcons||(exports.TreeListCaretIcons={})).Right="right",I.Down="down",r.configure({enforceActions:"observed"});class D{constructor(e,r,i){this.state=r,this.icons={},this.defaultExpandedDepth=0,this._innerPadding=null,this.instanceRef=t.createRef(),this.events=new n.EventEmitter,this.setActiveNode=e=>{this.state.activeNodeId=e},this.setEditedNode=e=>{this.state.editedNodeId=e},this.scrollToItem=e=>{if(!this.instanceRef.current)return;v(e)&&this.toggleExpand(e,!0);let t=this.tree.indexOf(e);if(-1===t)return;const n=this.instanceRef.current.props,{itemCount:r}=n;if(!D.isFixedSizeList(n))return void this.instanceRef.current.scrollToItem(t,"start");const{scrollOffset:i}=this.instanceRef.current.state;t=Math.max(0,Math.min(t+(this.innerPadding?1:0),r-1));const o=D.getOffsetForIndexAndAlignment(n,t,i,this.innerPadding);o===i||this.instanceRef.current.scrollTo(o)},this.rename=async(e,t)=>{this.setEditedNode(e.id);const r=new n.DisposableCollection;try{return await new Promise((e,n)=>{r.pushAll([this.events.on(exports.TreeListEvents.BeforeEditComplete,async(e,n)=>{try{void 0!==t&&await t(e,n),this.events.emit(exports.TreeListEvents.AfterEditComplete,e,n)}catch(e){this.events.emit(exports.TreeListEvents.ValidationError,e)}}),this.events.on(exports.TreeListEvents.AfterEditComplete,e),this.events.on(exports.TreeListEvents.EditCancel,n)])})}finally{r.dispose(),this.setEditedNode(null)}},this.tree=e,Object.assign(this,i),this.placeholderId=h()}get innerPadding(){return this._innerPadding}set innerPadding(e){this._innerPadding=e}dispose(){this.events.dispose()}static isFixedSizeList(e){return"number"==typeof e.itemSize}static getOffsetForIndexAndAlignment({direction:e,height:t,itemCount:n,itemSize:r,layout:i,width:o},s,a,l){const d=Number("horizontal"===e||"horizontal"===i?o:t)-(null!=l?l:0),c=Math.max(0,n*r-d),h=Math.min(c,s*r);return a>=Math.max(0,s*r-d+r)&&a<=h?a:h}toggleExpand(e,t){m(e);const{expanded:n}=this.state;if(void 0===t||t!==n[e.id]){const n=this.state.expanded[e.id]=null!=t?t:!this.isNodeExpanded(e);this.events.emit(exports.TreeListEvents.NodeExpand,e,n),n?this.tree.unwrap(e):this.tree.wrap(e)}if(!this.isNodeExpanded(e))return;const r=e.parent;null===r||this.isNodeExpanded(r)||this.toggleExpand(r,!0)}expandAll(e){for(const t of this.tree)v(t)&&null!==t.parent&&(void 0===e||e(t))&&this.toggleExpand(t,!0)}collapseAll(e){for(const t of this.tree)v(t)&&null!==t.parent&&(void 0===e||e(t))&&this.toggleExpand(t,!1)}static isNodeExpanded(e,t,n){return!(e.id in t)&&b.getLevel(e)<=n||!0===t[e.id]}isNodeExpanded(e){return D.isNodeExpanded(e,this.state.expanded,this.defaultExpandedDepth)}isAllExpanded(){return this.tree.every(e=>null===e.parent||!v(e)||this.isNodeExpanded(e))}isAllCollapsed(){return this.tree.every(e=>null===e.parent||!v(e)||!this.isNodeExpanded(e))}async create(e,t,n){const r=Object.assign(e,{name:"",parent:t});this.tree.invalidateNode(r),this.toggleExpand(t,!0),this.tree.insertNode(r,t);try{return await this.rename(r,n),null!==r.parent&&this.tree.invalidateNode(r.parent),r}catch(e){throw this.tree.removeNode(r),e}}}d([r.observable.shallow,c("design:type",Object)],D.prototype,"tree",void 0),d([r.observable,c("design:type",Object)],D.prototype,"icons",void 0),d([r.observable,c("design:type",Object)],D.prototype,"_innerPadding",void 0),d([r.computed,c("design:type",Object),c("design:paramtypes",[Object])],D.prototype,"innerPadding",null),d([r.action,c("design:type",Object)],D.prototype,"setActiveNode",void 0),d([r.action,c("design:type",Object)],D.prototype,"setEditedNode",void 0),d([r.action,c("design:type",Function),c("design:paramtypes",[Object,Boolean]),c("design:returntype",void 0)],D.prototype,"toggleExpand",null);class k{constructor(){this.attach=e=>{null!==this.node&&(document.body.appendChild(this.node),e.dataTransfer.setDragImage(this.node,-10,-10),setTimeout(this.detach,0))},this.detach=()=>{null!==this.node&&this.node.remove()},"undefined"!=typeof document?(this.node=document.createElement("span"),this.node.className=o(i.Classes.TAG,i.Classes.ROUND),this.node.style.zIndex=String(8388598)):this.node=null}get content(){var e,t;return null!==(t=null===(e=this.node)||void 0===e?void 0:e.textContent)&&void 0!==t?t:null}set content(e){null!==this.node&&(this.node.textContent=e)}}function O(e){if("undefined"==typeof document)return;const t=document.createElement("style");return t.textContent=e,document.body.appendChild(t)}class R{constructor(e){this.rootZoneId=e,this.cache=new WeakMap}setGenericStyles(){this.genericStyle=O(R.generateStyles("[data-drop-zone-id]:hover",{"background-color":"inherit",color:"inherit"}))}clearGenericStyles(){void 0!==this.genericStyle&&(this.genericStyle.remove(),this.genericStyle=void 0)}setRange(e){const t=O(R.generateStyles(null===e.parent?`[data-root-drop-zone="${this.rootZoneId}"] [data-drop-zone-id]:not([data-active-tree-node])`:`[data-drop-zone-id^="${b.getDropZoneId(e)}"]:not([data-active-tree-node])`,{"background-color":"var(--highlighted-bg) !important",color:"var(--highlighted-fg) !important"}));void 0!==t&&this.cache.set(e,t)}clearRange(e){const t=this.cache.get(e);void 0!==t&&(t.remove(),this.cache.delete(e))}static generateStyles(e,t){return`\n      ${e} { ${n=t,Object.entries(n).map(e=>e.join(":")).join(";")} }\n    `;var n}}class S{constructor(){this.dropPermissions=new Map,this.id=S.seed++,this.highlighter=new R(this.id),this.ghost=new k}clear(){void 0!==this.currentDragZone&&this.highlighter.clearRange(this.currentDragZone),this.highlighter.clearGenericStyles(),void 0!==this.collapseTimeout&&(this.collapseTimeout=clearTimeout(this.collapseTimeout)),this.initialNode=void 0,this.initialDragZone=void 0,this.currentDragZone=void 0,this.dropPermissions.clear()}}S.seed=0;const _={store:new D(new b,new E),draggable:new S},j=t.createContext(_),M=t.createContext({}),P=({store:e,className:n,innerClassName:r,itemClassName:i,children:o})=>{const s={draggable:t.useRef(new S).current,store:e},a={itemClassName:i,innerClassName:r,className:n};return t.createElement(j.Provider,{value:s},t.createElement(M.Provider,{value:a},o))},F=e=>t.useContext(M)[e],A=e=>e.map((e,n)=>{const{divider:r,children:o,...s}=e;return r?t.createElement(i.Menu.Divider,Object.assign({key:n},s)):t.createElement(i.Menu.Item,Object.assign({key:n},s),o&&o.length?A(o):null)}),z=e=>t.createElement(i.Menu,null,A(e.items));function Z(){return t.useContext(j).draggable}function W(){return t.useContext(j).store}const $=(e,n)=>{const{state:{activeNodeId:r}}=W(),o=Z();return t.useCallback(s=>{if(!n)return;const a=n(e);void 0!==a&&(s.preventDefault(),s.stopPropagation(),a.length>0&&(r!==e.id&&v(e)&&null!==e.parent&&o.highlighter.setRange(e),i.ContextMenu.show(t.createElement(z,{items:a}),{left:s.clientX,top:s.clientY},()=>{v(e)&&o.highlighter.clearRange(e)})))},[n,r,o,e])},B=(e,n)=>{const r=W();return t.useCallback(t=>{null!==n&&r.events.emit(e,t,n)},[r,e,n])},q=({children:e,className:n,style:r,onContextMenu:i})=>{const o=W(),s=Z();t.useEffect(()=>()=>{s.clear()},[s]);const a=t.useCallback(e=>{void 0!==s.currentDragZone&&s.dropPermissions.get(s.currentDragZone.id)&&e.preventDefault()},[s]),l=t.useCallback(()=>{s.clear()},[s]),d=t.useCallback(e=>{e.preventDefault();const{initialNode:t,currentDragZone:n}=s;try{void 0!==t&&void 0!==n&&o.events.emit(exports.TreeListEvents.Drop,t,n)}finally{s.clear()}},[s,o]);return t.createElement("div",{className:n,style:r,"data-root-drop-zone":s.id,onDrop:d,onDragOver:a,onDragEnd:l,onContextMenu:i},e)},G=s.observer(e=>{const{node:n,tree:r,autoExpandDelay:i,canDrop:o,canDrag:s,rowHeight:a,rowRenderer:l,className:d,draggable:c,...h}=e,{draggable:u}=t.useContext(j),p=W(),g=v(n)?n:n.parent;if(null===g)throw new Error("Cannot drag root node");const f=t.useCallback(e=>{const{dropPermissions:t,currentDragZone:r,initialDragZone:s,collapseTimeout:a,initialNode:l,highlighter:d}=u;if(void 0!==a&&(u.collapseTimeout=clearTimeout(a)),void 0===s||void 0===l)return;let c=t.get(e.id);void 0===c&&(c=void 0===o||o(l,e),t.set(e.id,!!c)),void 0!==r&&d.clearRange(r),e.id!==s.id&&c?(u.currentDragZone=e,d.setRange(e),v(n)&&(u.collapseTimeout=setTimeout(p.toggleExpand.bind(p,n,!0),i))):u.currentDragZone=void 0},[u,n,n.parent,o,p,i]),m=t.useCallback(()=>{f(g)},[g,f]),x=t.useCallback(e=>{if(void 0!==s&&!s(n))return void e.preventDefault();u.currentDragZone=g,u.initialDragZone=g,u.initialNode=n;const t=n.parent;t&&u.dropPermissions.set(t.id,!1),u.highlighter.setGenericStyles(),e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setData("text/plain",n.id),u.ghost.content=n.name,u.ghost.attach(e),v(n)&&p.toggleExpand(n,!1)},[s,n,n.parent,u.currentDragZone,u.initialDragZone,u.initialNode,u.highlighter,u.ghost,u.dropPermissions,g,p]),C=t.useCallback(e=>{e.relatedTarget&&"closest"in e.relatedTarget&&!e.relatedTarget.closest("[data-drop-zone-id]")&&e.relatedTarget.closest("[data-root-drop-zone]")&&f(r.root)},[f,r.root]);return!1===c?t.createElement("div",Object.assign({},h,{className:d})):t.createElement("div",Object.assign({},h,{className:d,draggable:!0,onDragStart:x,onDragEnter:m,onDragLeave:C}))}),V=s.observer(({className:e,node:n,placeholder:r})=>{const s=W(),[a,l]=t.useState(null),d=t.useRef();t.useEffect(()=>s.events.on(exports.TreeListEvents.ValidationError,e=>{l(e.message)}).dispose,[s,l]),t.useEffect(()=>{const{current:e}=d;if(e){const t=e.value.indexOf(".");e.setSelectionRange(0,-1===t?e.value.length:t,"forward")}},[]);const c=t.useCallback(e=>{""!==e.target.value&&l(null)},[]),h=t.useCallback(()=>{s.events.emit(exports.TreeListEvents.EditCancel)},[s]),u=t.useCallback(e=>{switch(e.key){case"Enter":n.name=d.current.value,s.events.emit(exports.TreeListEvents.BeforeEditComplete,n,n.parent);break;case"Escape":h()}},[n,s,h]),p=t.useCallback(e=>{const t=e.target.value,n=t.indexOf(".");e.target.setSelectionRange(0,-1===n?t.length:n,"forward")},[]);return t.createElement(i.Popover,{minimal:!0,isOpen:null!==a,usePortal:!0,position:i.Position.BOTTOM_RIGHT,className:"w-full flex-shrink",targetClassName:"w-full",target:t.createElement("input",{autoFocus:!0,autoComplete:"off",ref:d,className:o(e,"TreeListItem__input"),onKeyDown:u,onInput:c,onBlur:h,onFocus:p,defaultValue:n.name,placeholder:r}),content:t.createElement(i.Callout,{intent:i.Intent.DANGER},a)})}),H={[exports.TreeListCaretIcons.Down]:{default:"chevron-down"},[exports.TreeListCaretIcons.Right]:{default:"chevron-right"}},U=({expanded:e,node:n,icons:r})=>{const o=W();let s=null;if(v(n)){const a=e?exports.TreeListCaretIcons.Down in r?r[exports.TreeListCaretIcons.Down]:H[exports.TreeListCaretIcons.Down]:exports.TreeListCaretIcons.Right in r?r[exports.TreeListCaretIcons.Right]:H[exports.TreeListCaretIcons.Right],l="function"==typeof a?a.call(o,n):a;null!=l&&null!==l.default&&(s=t.createElement(i.FAIcon,{size:"sm",icon:l.default,style:{color:l.color}}))}return t.createElement("span",{className:"TreeListItem__caret"},s)};const K=s.observer(({expanded:e,icons:n,node:r})=>{const o=W(),s=void 0!==r.type?n[r.type]:void 0,a="function"==typeof s?s.call(o,r):s;if(void 0===a)return null;const l=function(e,t){return null===e?e:t&&void 0!==e.expanded?e.expanded:e.default}(a,!!e);return t.createElement("span",{className:"TreeListItem__icon"},null!=l?t.createElement(i.FAIcon,{icon:l,style:{color:null==a?void 0:a.color}}):null)}),Y=800,X=30,J=s.observer(({className:e,isExpanded:n,isEdited:r,isExpandable:i,node:s,placeholder:a})=>{const l=W(),d=B(exports.TreeListEvents.NodeCaretClick,s);return t.createElement("div",{className:o("flex-1 flex items-center",e),style:{paddingLeft:15*b.getLevel(s)}},i&&t.createElement(U,{onClick:d,expanded:n,icons:l.icons,node:s}),t.createElement(K,{expanded:n,icons:l.icons,node:s}),r?t.createElement(V,{node:s,placeholder:a}):t.createElement("span",{className:"TreeListItem__label",title:s.name},s.name))}),Q=s.observer(e=>{const{data:n,index:r,style:i}=e,{innerPadding:s,tree:a,rowRenderer:l,generateContextMenu:d,striped:c,...h}=n,u=F("itemClassName"),p=W(),g=s?r-1:r,f=-1===g?null:a.itemAt(g);if(void 0===f)throw new Error("Could not find node.");const m=B(exports.TreeListEvents.NodeClick,f),x=B(exports.TreeListEvents.NodeMouseEnter,f),C=B(exports.TreeListEvents.NodeMouseLeave,f),N=$(f,d);if(null===f)return t.createElement("div",{style:i});const y=p.state.editedNodeId===f.id,E=p.state.activeNodeId===f.id,w=v(f)&&p.isNodeExpanded(f),T=o(`TreeListItem TreeListItem--${b.getLevel(f)}`,f.className,u,{"TreeListItem--active":E,"TreeListItem--striped":c&&g%2!=0});let L;L="function"==typeof l?l(f,{isEdited:y,isExpanded:w}):t.createElement(J,{node:f,isEdited:y,isExpanded:w});const I={...i,...s&&i&&i.top&&{top:Number(i.top)-s}};return p.state.editedNodeId===f.id?t.createElement("div",{key:f.id,className:T,style:I},L):t.createElement(G,Object.assign({key:f.id,className:T,"data-drop-zone-id":b.getDropZoneId(f),node:f,onClick:m,onMouseEnter:x,onMouseLeave:C,onContextMenu:N,tree:a,style:I},E&&{"data-active-tree-node":!0},h),L)}),ee=s.observer(e=>{const{autoExpandDelay:n=Y,rowHeight:r=X,rowRenderer:i,canDrag:s,canDrop:a,generateContextMenu:d,style:c,striped:h,innerPadding:u,autoSize:p,maxRows:g,interactive:f=!0,initialScrollOffset:m,onScroll:v,draggable:x}=e,C=W(),N=F("className"),y=F("innerClassName"),b=$(C.tree.root,d),E=C.instanceRef,w=C.tree;if("boolean"==typeof u&&"function"==typeof r)throw new Error("You need to provide an absolute value for padding in case of VariableSizeList");const T="boolean"==typeof u?Number(r)/2:u,L=w.count+(T?1:0);t.useEffect(()=>{C.innerPadding=null!=T?T:null},[T,C]),t.useEffect(()=>{null!==E.current&&"resetAfterIndex"in E.current&&E.current.resetAfterIndex(0,!0)},[E,w.versionCounter]);const I={canDrag:s,canDrop:a,autoExpandDelay:n,rowRenderer:i,rowHeight:r,innerPadding:T,tree:w,generateContextMenu:d,striped:h,draggable:!1!==x},D=t.useCallback(e=>{if(T&&0===e)return C.placeholderId;const t=w.itemAt(T?e-1:e);return t?`${t.id}-${t.type}`:""},[w,C.placeholderId,T]),k=t.useCallback(e=>{if(0===e&&T)return 2*T;const t=T?e-1:e,n=w.itemAt(t);return"function"==typeof r&&void 0!==n?r(n,t):0},[T,w,r]),O={className:y,itemData:I,itemKey:D,itemCount:L,maxRows:g,initialScrollOffset:m,onScroll:v};return 0===L?null:t.createElement(q,{style:c,onContextMenu:b,className:o("TreeList",N,{"TreeList--interactive":f})},"function"!=typeof r?t.createElement(l.FixedSizeList,Object.assign({},O,{autoSize:p,instanceRef:E,itemSize:r}),Q):t.createElement(l.VariableSizeList,Object.assign({},O,{instanceRef:E,itemSize:k}),Q))}),te=({error:e})=>t.createElement("div",{className:"p-4"},t.createElement("b",null,"Error"),e&&`: ${e.message}`),ne=({onError:e,FallbackComponent:n=te,store:r,className:i,innerClassName:o,itemClassName:s,...l})=>t.createElement(a.ErrorBoundary,{onError:e,FallbackComponent:n},t.createElement(P,{store:r,className:i,itemClassName:s,innerClassName:o},t.createElement(ee,Object.assign({},l))));ne.displayName="TreeList",exports.ComputableTree=T,exports.GenericTree=w,exports.Tree=b,exports.TreeList=ne,exports.TreeListEditableItem=V,exports.TreeListRow=J,exports.TreeState=E,exports.TreeStore=D,exports.assertNode=function(e){if(void 0===e)throw new TypeError("Node expected")},exports.assertParentNode=m,exports.isDeprecatedTreeListNode=e=>"object"==typeof e&&null!==e&&"level"in e,exports.isParentNode=v,exports.useClassName=F,exports.useContextMenu=$,exports.useDraggable=Z,exports.useNodeCallback=B,exports.useStore=W;
