import{Classes as e,Icon as n}from"@blueprintjs/core";import t from"classnames";import{createElement as r,useMemo as o,useRef as a,useEffect as l,Fragment as i}from"react";import{ErrorBoundary as s}from"@stoplight/react-error-boundary";import{Reader as c}from"@stoplight/markdown/reader";import{Icon as d,Callout as m,Classes as u,Checkbox as k,HTMLTable as p}from"@stoplight/ui-kit";import{CodeViewer as h}from"@stoplight/ui-kit/CodeViewer";import{SimpleTabs as b,SimpleTabList as y,SimpleTab as g,SimpleTabPanel as f}from"@stoplight/ui-kit/SimpleTabs";import w from"sanitize-html";const N={padded:"MV_padded",bordered:"MV_bordered",block:"MV_block",tabContainer:"MV_tab_container",blockHeader:"MV_block_header",blockTitle:"MV_block_title"},v=({title:n})=>r("div",{className:t(e.TEXT_MUTED,N.blockTitle)},n),C=({icon:e,iconColor:o,title:a,className:l})=>r("div",{className:t(N.blockHeader,l,"flex items-center")},e&&r("div",{style:{lineHeight:0}},r(n,{icon:e,iconSize:14,color:o})),r(v,{title:a}));function O(e,n){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.indexOf(r)<0&&(t[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)n.indexOf(r[o])<0&&(t[r[o]]=e[r[o]])}return t}const T=require("unified"),S=require("remark-slug"),M=require("remark-inline-links"),_=e=>T().use([S]).use(M,{commonmark:!0}).runSync(e),j=e=>{const n=new c;return n.toSpec(_(n.fromLang(e)))},E=e=>o(()=>"string"==typeof e?j(e):e,[e]),V=({id:e})=>{const n=a(null);return l(()=>{if("undefined"!=typeof window){window.location.hash.replace("#","").toLowerCase()===e.toLowerCase()&&requestAnimationFrame(()=>n.current&&n.current.scrollIntoView())}},[]),r("a",{key:"anchor",ref:n,id:e,className:"anchor",href:`#${e}`,"aria-hidden":!0},r(d,{icon:"link"}))},x={strong:(e,n)=>r("strong",{key:n},e.children),emphasis:(e,n)=>r("i",{key:n},e.children),delete:(e,n)=>r("s",{key:n},e.children),paragraph:(e,n)=>r("p",{key:n},e.children),blockquote:({node:e,children:n},o)=>{const{annotations:a}=e;return r(m,{key:o,className:t(u.BLOCKQUOTE),intent:a&&a.theme||"primary",icon:null},n)},inlineCode:({node:e},n)=>r(h,{key:n,className:"inline-block line-none",value:String(e.value),inline:!0}),code:({node:e},n)=>{const{lang:o,value:a,annotations:l}=e,s=(e=>{switch(e){case"http":return"yaml";default:return e}})(o);let c=!(void 0!==l&&"lineNumbers"in l)||!!l.lineNumbers;s&&!["md","markdown","bash","shell"].includes(s)||(c=!1);const d=e.annotations&&e.annotations.title;return r(i,{key:n},d&&r(C,{icon:"code",iconColor:"#22a6b3",title:d}),r(h,{className:t("overflow-auto",N.block),value:String(a),language:s,showLineNumbers:c}))},image:({node:e},n)=>r("img",{key:n,src:e.url,title:e.title,alt:e.alt}),imageReference:({node:e},n)=>r("span",{key:n},String(e.label)),link:({node:e,children:n},t)=>r("a",{key:t,href:e.url,title:e.title},n),heading:({node:e,children:n},t)=>(n=n||[],e.data&&e.data.id&&n.unshift(r(V,{key:`${t}-anchor`,id:e.data.id})),r(`h${e.depth}`,{key:t,className:u.HEADING,children:n})),html:({node:e},n)=>{const t=w(e.value,{allowedTags:[...w.defaults.allowedTags,"dl","dt","dd","h1","h2"],disallowedTagsMode:"escape"});return r("div",{key:n,dangerouslySetInnerHTML:{__html:t}})},linkReference:({node:e},n)=>r("span",{key:n},String(e.label)),list:({node:e,children:n},o)=>e.ordered?r("ol",{key:o,className:t(u.LIST,"list-decimal"),start:e.start},n):r("ul",{key:o,className:t(u.LIST,"list-disc")},n),listItem:({node:e,children:n},t)=>null!==e.checked?r(k,{key:t,className:"flex items-center",defaultChecked:!!e.checked,labelElement:n}):r("li",{key:t},n),table:({node:e,children:n},o)=>{const a=e.annotations&&e.annotations.title;return r(i,{key:o},a&&r(C,{title:a,icon:"th-list",className:u.TEXT_MUTED}),r(p,{className:t("border-l border-r border-b",N.block),condensed:!0,bordered:!0,striped:!0},r("tbody",null,n)))},tableRow:({children:e},n)=>r("tr",{key:n},e),tableCell:(e,n)=>{const{align:o}=e.parent.parent;return r("td",{key:n,className:t(o&&o[n]&&`text-${o[n]}`)},e.children)},tabContainer:({node:e,children:n},o)=>r(b,{key:o,className:t(N.block,N.tabContainer),id:o},r(y,null,e.children.map((e,n)=>r(g,{key:n},e.annotations.title))),n&&n.map((e,n)=>r(f,{key:n,className:"py-6 px-5"},e))),tab:({children:e},n)=>r(i,{key:n},e),text:({node:e},n)=>r(i,{key:n},String(e.value)),jira:({node:e},n)=>r(i,{key:n},String(e.value)),thematicBreak:(e,n)=>r("hr",{key:n,className:"border my-12 -mx-2"}),yaml:()=>null,definition:()=>null},L=(e,n=x,t=[])=>{if(!Array.isArray(e.children)||e.children.length<=0)return null;const r=Object.assign({},e);return delete r.position,delete r.children,e.children.map((e,o)=>{const a=n[e.type];if(!a)return console.warn("No component mapping for",e.type,e),null;const l=t.concat("children",o);return a({path:l,node:e,parent:r,children:L(Object.assign(Object.assign({},e),{parent:r}),n,l),defaultComponents:x},o)})},I=e=>{var{markdown:n,className:a,components:l}=e,i=O(e,["markdown","className","components"]);const s=E(n),c=o(()=>Object.assign(Object.assign({},x),l),[l]);return r("div",Object.assign({className:t("MarkdownViewer",a)},i),L(s,c))};I.displayName="MarkdownViewer.Component";const q=({error:e})=>r("div",{className:"p-4"},r("b",null,"Error"),e&&`: ${e.message}`),H=e=>{var{onError:n,FallbackComponent:t=q}=e,o=O(e,["onError","FallbackComponent"]);return r(s,{onError:n,FallbackComponent:t},r(I,Object.assign({},o)))};H.displayName="MarkdownViewer";export{C as BlockHeader,v as BlockTitle,N as CLASSNAMES,H as MarkdownViewer,j as processMarkdown,_ as processMarkdownTree,E as useMarkdownTree};
