"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var core=require("@blueprintjs/core"),cn=_interopDefault(require("classnames")),React=require("react"),reactErrorBoundary=require("@stoplight/react-error-boundary"),reader=require("@stoplight/markdown/reader"),uiKit=require("@stoplight/ui-kit"),CodeViewer=require("@stoplight/ui-kit/CodeViewer"),SimpleTabs=require("@stoplight/ui-kit/SimpleTabs"),sanitize=_interopDefault(require("sanitize-html"));const CLASSNAMES={padded:"MV_padded",bordered:"MV_bordered",block:"MV_block",tabContainer:"MV_tab_container",blockHeader:"MV_block_header",blockTitle:"MV_block_title"},BlockTitle=({title:e})=>React.createElement("div",{className:cn(core.Classes.TEXT_MUTED,CLASSNAMES.blockTitle)},e),BlockHeader=({icon:e,iconColor:t,title:a,className:r})=>React.createElement("div",{className:cn(CLASSNAMES.blockHeader,r,"flex items-center")},e&&React.createElement("div",{style:{lineHeight:0}},React.createElement(core.Icon,{icon:e,iconSize:14,color:t})),React.createElement(BlockTitle,{title:a}));function __rest(e,t){var a={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&(a[r[n]]=e[r[n]])}return a}const unified=require("unified"),remarkSlug=require("remark-slug"),links=require("remark-inline-links"),processMarkdownTree=e=>unified().use([remarkSlug]).use(links,{commonmark:!0}).runSync(e),processMarkdown=e=>{const t=new reader.Reader;return t.toSpec(processMarkdownTree(t.fromLang(e)))},useMarkdownTree=e=>React.useMemo(()=>"string"==typeof e?processMarkdown(e):e,[e]),AnchorLink=({id:e})=>{const t=React.useRef(null);return React.useEffect(()=>{if("undefined"!=typeof window){window.location.hash.replace("#","").toLowerCase()===e.toLowerCase()&&requestAnimationFrame(()=>t.current&&t.current.scrollIntoView())}},[]),React.createElement("a",{key:"anchor",ref:t,id:e,className:"anchor",href:`#${e}`,"aria-hidden":!0},React.createElement(uiKit.Icon,{icon:"link"}))},getCodeLanguage=e=>{switch(e){case"http":return"yaml";default:return e}},defaultComponentMapping={strong:(e,t)=>React.createElement("strong",{key:t},e.children),emphasis:(e,t)=>React.createElement("i",{key:t},e.children),delete:(e,t)=>React.createElement("s",{key:t},e.children),paragraph:(e,t)=>React.createElement("p",{key:t},e.children),blockquote:({node:e,children:t},a)=>{const{annotations:r}=e;return React.createElement(uiKit.Callout,{key:a,className:cn(uiKit.Classes.BLOCKQUOTE),intent:r&&r.theme||"primary",icon:null},t)},inlineCode:({node:e},t)=>React.createElement(CodeViewer.CodeViewer,{key:t,className:"inline-block line-none",value:String(e.value),inline:!0}),code:({node:e},t)=>{const{lang:a,value:r,annotations:n}=e,l=getCodeLanguage(a);let c=!(void 0!==n&&"lineNumbers"in n)||!!n.lineNumbers;l&&!["md","markdown","bash","shell"].includes(l)||(c=!1);const o=e.annotations&&e.annotations.title;return React.createElement(React.Fragment,{key:t},o&&React.createElement(BlockHeader,{icon:"code",iconColor:"#22a6b3",title:o}),React.createElement(CodeViewer.CodeViewer,{className:cn("overflow-auto",CLASSNAMES.block),value:String(r),language:l,showLineNumbers:c}))},image:({node:e},t)=>React.createElement("img",{key:t,src:e.url,title:e.title,alt:e.alt}),imageReference:({node:e},t)=>React.createElement("span",{key:t},String(e.label)),link:({node:e,children:t},a)=>React.createElement("a",{key:a,href:e.url,title:e.title},t),heading:({node:e,children:t},a)=>(t=t||[],e.data&&e.data.id&&t.unshift(React.createElement(AnchorLink,{key:`${a}-anchor`,id:e.data.id})),React.createElement(`h${e.depth}`,{key:a,className:uiKit.Classes.HEADING,children:t})),html:({node:e},t)=>{const a=sanitize(e.value,{allowedTags:[...sanitize.defaults.allowedTags,"dl","dt","dd","h1","h2"],disallowedTagsMode:"escape"});return React.createElement("div",{key:t,dangerouslySetInnerHTML:{__html:a}})},linkReference:({node:e},t)=>React.createElement("span",{key:t},String(e.label)),list:({node:e,children:t},a)=>e.ordered?React.createElement("ol",{key:a,className:cn(uiKit.Classes.LIST,"list-decimal"),start:e.start},t):React.createElement("ul",{key:a,className:cn(uiKit.Classes.LIST,"list-disc")},t),listItem:({node:e,children:t},a)=>null!==e.checked?React.createElement(uiKit.Checkbox,{key:a,className:"flex items-center",defaultChecked:!!e.checked,labelElement:t}):React.createElement("li",{key:a},t),table:({node:e,children:t},a)=>{const r=e.annotations&&e.annotations.title;return React.createElement(React.Fragment,{key:a},r&&React.createElement(BlockHeader,{title:r,icon:"th-list",className:uiKit.Classes.TEXT_MUTED}),React.createElement(uiKit.HTMLTable,{className:cn("border-l border-r border-b",CLASSNAMES.block),condensed:!0,bordered:!0,striped:!0},React.createElement("tbody",null,t)))},tableRow:({children:e},t)=>React.createElement("tr",{key:t},e),tableCell:(e,t)=>{const{align:a}=e.parent.parent;return React.createElement("td",{key:t,className:cn(a&&a[t]&&`text-${a[t]}`)},e.children)},tabContainer:({node:e,children:t},a)=>React.createElement(SimpleTabs.SimpleTabs,{key:a,className:cn(CLASSNAMES.block,CLASSNAMES.tabContainer),id:a},React.createElement(SimpleTabs.SimpleTabList,null,e.children.map((e,t)=>React.createElement(SimpleTabs.SimpleTab,{key:t},e.annotations.title))),t&&t.map((e,t)=>React.createElement(SimpleTabs.SimpleTabPanel,{key:t,className:"py-6 px-5"},e))),tab:({children:e},t)=>React.createElement(React.Fragment,{key:t},e),text:({node:e},t)=>React.createElement(React.Fragment,{key:t},String(e.value)),jira:({node:e},t)=>React.createElement(React.Fragment,{key:t},String(e.value)),thematicBreak:(e,t)=>React.createElement("hr",{key:t,className:"border my-12 -mx-2"}),yaml:()=>null,definition:()=>null},renderNodeChildren=(e,t=defaultComponentMapping,a=[])=>{if(!Array.isArray(e.children)||e.children.length<=0)return null;const r=Object.assign({},e);return delete r.position,delete r.children,e.children.map((e,n)=>{const l=t[e.type];if(!l)return console.warn("No component mapping for",e.type,e),null;const c=a.concat("children",n);return l({path:c,node:e,parent:r,children:renderNodeChildren(Object.assign(Object.assign({},e),{parent:r}),t,c),defaultComponents:defaultComponentMapping},n)})},MarkdownViewerComponent=e=>{var{markdown:t,className:a,components:r}=e,n=__rest(e,["markdown","className","components"]);const l=useMarkdownTree(t),c=React.useMemo(()=>Object.assign(Object.assign({},defaultComponentMapping),r),[r]);return React.createElement("div",Object.assign({className:cn("MarkdownViewer",a)},n),renderNodeChildren(l,c))};MarkdownViewerComponent.displayName="MarkdownViewer.Component";const MarkdownViewerFallbackComponent=({error:e})=>React.createElement("div",{className:"p-4"},React.createElement("b",null,"Error"),e&&`: ${e.message}`),MarkdownViewer=e=>{var{onError:t,FallbackComponent:a=MarkdownViewerFallbackComponent}=e,r=__rest(e,["onError","FallbackComponent"]);return React.createElement(reactErrorBoundary.ErrorBoundary,{onError:t,FallbackComponent:a},React.createElement(MarkdownViewerComponent,Object.assign({},r)))};MarkdownViewer.displayName="MarkdownViewer",exports.BlockHeader=BlockHeader,exports.BlockTitle=BlockTitle,exports.CLASSNAMES=CLASSNAMES,exports.MarkdownViewer=MarkdownViewer,exports.processMarkdown=processMarkdown,exports.processMarkdownTree=processMarkdownTree,exports.useMarkdownTree=useMarkdownTree;
